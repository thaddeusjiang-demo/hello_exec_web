#!/bin/sh
set -euo pipefail

echo "🚀 Building HelloExecWeb..."

# 构建 Swift 启动器
swift build

# 获取构建目录
target_dir=`swift build --show-bin-path`

# 构建静态资源
echo "🎨 Building assets..."
(cd ../.. && mix assets.build)

# 构建 Phoenix 应用到指定目录
echo "📦 Building Phoenix release..."
(cd ../.. && mix release --overwrite --path=$target_dir/rel)

echo "🌐 Starting HelloExecWeb..."
echo "📱 Browser will open automatically at http://localhost:4000"

# 设置 Phoenix 服务器环境变量并启动应用
export PHX_SERVER=true
$target_dir/HelloExecWeb
